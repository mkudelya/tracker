{% extends "TrackerBundle::layout.html.twig" %}

{% block breadcrumb %}
    <a href="{{ path('_tracking_project_list') }}">{{ 'project.projects_list'|trans({}, 'TrackerBundle') }}</a> /
    <a href="{{ path('_tracking_project_show', {'projectCode' : project.getCode()}) }}">{{ project.getCode() }}</a> /
    {% if isSubtask %}
    <a href="{{ path('_tracking_issue_show', {'projectCode': project.getCode(), 'issueCode': issue.getParent().getCode()}) }}">{{ issue.getParent().getCode() }}</a> /
    {% endif %}
    <a href="{{ path('_tracking_issue_show', {'projectCode': project.getCode(), 'issueCode': issue.getCode()}) }}">{{ issue.getCode() }}</a>
{% endblock %}

{% block description %}{{ issue.getSummary() }}{% endblock %}

{% block page_actions %}
    {% if is_granted('edit', issue) %}
        [ <a href="{{ path('_tracking_issue_edit', {'projectCode': project.getCode(), 'issueCode': issue.getCode()}) }}">{{ 'issue.edit'|trans({}, 'TrackerBundle') }}</a> ]
    {% endif %}
    {% if isStory %}
        {% if is_granted('add_issue', issue.getProject()) %}
            <br>[ <a href="{{ path('_tracking_issue_add_subtask', {'projectCode': project.getCode(), 'issueCode': issue.getCode()}) }}">{{ 'issue.add_sub'|trans({}, 'TrackerBundle') }}</a> ]
        {% endif %}
    {% endif %}
{% endblock %}

{% block content %}
    <p>{{ 'issue.project'|trans({}, 'TrackerBundle') }} : {{ issue.getProject().getSummary() }}</p>
    <p>{{ 'issue.type'|trans({}, 'TrackerBundle') }} : {{ issue.getType() }}</p>
    <p>{{ 'issue.reporter'|trans({}, 'TrackerBundle') }} : {{ issue.getReporter().getFullName() }}</p>
    <p>{{ 'issue.assignee'|trans({}, 'TrackerBundle') }} : {{ issue.getAssignee().getFullName() }}</p>
    <p>{{ 'issue.status'|trans({}, 'TrackerBundle') }} : {{ issue.getStatus() }}</p>
    <p>{{ 'issue.resolution'|trans({}, 'TrackerBundle') }} : {{ issue.getResolution() }}</p>

    <p>{{ 'issue.created'|trans({}, 'TrackerBundle') }} : {{ issue.getCreated()|date("m/d/Y", false) }}</p>
    <p>{{ 'issue.updated'|trans({}, 'TrackerBundle') }} : {{ issue.getUpdated()|date("m/d/Y", false) }}</p>

    <p>{{ 'issue.description'|trans({}, 'TrackerBundle') }} : {{ issue.getDescription() }}</p>

    <hr>
    <p>
    <p><b>{{ 'layout.activity_list'|trans({}, 'TrackerBundle') }}:</b></p>
    {{ render(controller(
    'TrackerBundle:Activity:listByIssue',
    {'issueCode': issue.getCode()}
    )) }}
    </p>
    <hr>
    <p>
    <p><b>{{ 'layout.collaborators_list'|trans({}, 'TrackerBundle') }}:</b></p>
    {{ render(controller(
    'TrackerBundle:Issue:listCollaboratorByIssue',
    {'issueCode': issue.getCode()}
    )) }}
    </p>
    <hr>
    {% if isStory %}
        <p>
        <p><b>{{ 'issue.subissue_list'|trans({}, 'TrackerBundle') }}:</b></p>
        {{ render(controller(
        'TrackerBundle:Issue:subtasksList',
        {'projectCode': project.getCode(), 'issueCode': issue.getCode()}
        )) }}
        </p>
        <hr>
    {% endif %}

    <p>
    <p><b>{{ 'layout.comments_list'|trans({}, 'TrackerBundle') }}:</b></p>
    {{ render(controller(
    'TrackerBundle:Issue:listOfComments',
    {'issueCode': issue.getCode()}
    )) }}
    </p>
    {% if is_granted('add_comment', issue) %}
        <hr>
        <p>
            <p><b>{{ 'layout.add_comment'|trans({}, 'TrackerBundle') }}:</b></p>
            <form action="{{ path('_tracking_edit_comment', {'projectCode': project.getCode(), 'issueCode': issue.getCode()}) }}" {{ form_enctype(comment_form) }} method="POST" class="tracker_comment">
                {{ form_widget(comment_form) }}
            </form>
        </p>
    {% endif %}

    <script>
        $(function() {
            $('div > a#edit').click(function()
            {
                $('td > #body').each(function() {
                            $(this).show();
                        }
                );

                $('td > #form').each(function() {
                            $(this).hide();
                        }
                );

                var parent = $(this).parent().parent();
                parent.find('#body').hide();
                parent.find('#form').show();

                return false;
            })
        });
    </script>
{%  endblock %}